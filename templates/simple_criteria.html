<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Criteria - Porsche Tracker</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        .porsche-red { color: #d5001c; }
        .navbar-brand { font-weight: bold; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand porsche-red" href="/">
                <img src="https://logos-world.net/wp-content/uploads/2021/04/Porsche-Logo.png" 
                     alt="Porsche" 
                     width="40" 
                     height="30" 
                     style="margin-right: 8px; background: transparent; filter: invert(0); object-fit: contain;"
                     onerror="this.src='https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/porsche.svg'; this.style.filter='invert(1)';">
                
                Porsche Tracker
            </a>
            
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/listings"><i class="fas fa-list"></i> Listings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/watch-criteria"><i class="fas fa-eye"></i> Watch Criteria</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container my-4">
        <div class="row mb-4">
            <div class="col">
                <h1 class="display-4">
                    <i class="fas fa-eye porsche-red"></i> Watch Criteria
                </h1>
                <p class="lead">Manage your automated listing monitoring criteria</p>
            </div>
            <div class="col-auto">
                <a href="/create-criteria" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus"></i> Add New Criteria
                </a>
            </div>
        </div>

        <!-- Criteria List -->
        {% if criteria_list %}
            <div class="row">
                {% for criteria in criteria_list %}
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{{ criteria.name }}</h5>
                            <div>
                                {% if criteria.is_active %}
                                    <span class="badge bg-success">Active</span>
                                {% else %}
                                    <span class="badge bg-secondary">Inactive</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-sm-6">
                                    <strong>Models:</strong>
                                    <p class="text-muted">
                                        {% if criteria.models %}
                                            {{ criteria.models|replace('[', '')|replace(']', '')|replace('"', '') }}
                                        {% else %}
                                            All Models
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="col-sm-6">
                                    <strong>Price Range:</strong>
                                    <p class="text-muted">
                                        {% if criteria.min_price %}${{ "{:,}".format(criteria.min_price) }}{% else %}Any{% endif %} - 
                                        {% if criteria.max_price %}${{ "{:,}".format(criteria.max_price) }}{% else %}Any{% endif %}
                                    </p>
                                </div>
                                <div class="col-sm-6">
                                    <strong>Year Range:</strong>
                                    <p class="text-muted">
                                        {% if criteria.min_year %}{{ criteria.min_year }}{% else %}Any{% endif %} - 
                                        {% if criteria.max_year %}{{ criteria.max_year }}{% else %}Any{% endif %}
                                    </p>
                                </div>
                                <div class="col-sm-6">
                                    <strong>Max Distance:</strong>
                                    <p class="text-muted">
                                        {% if criteria.max_distance %}{{ criteria.max_distance }} miles{% else %}Any{% endif %}
                                    </p>
                                </div>
                            </div>
                            
                            {% if criteria.notification_email %}
                            <div class="mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-envelope"></i> {{ criteria.notification_email }}
                                </small>
                            </div>
                            {% endif %}
                            
                            <div class="mt-3">
                                <button class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="toggleCriteria({{ criteria.id }})">
                                    {% if criteria.is_active %}
                                        <i class="fas fa-pause"></i> Pause
                                    {% else %}
                                        <i class="fas fa-play"></i> Activate
                                    {% endif %}
                                </button>
                                <button class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                        {% if criteria.last_checked %}
                        <div class="card-footer text-muted">
                            <small>Last checked: {{ criteria.last_checked[:10] if criteria.last_checked else 'Never' }}</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-eye-slash fa-3x text-muted mb-3"></i>
                <h4>No watch criteria yet</h4>
                <p class="text-muted mb-4">Create your first watch criteria to start monitoring Porsche listings automatically.</p>
                <a href="/create-criteria" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus"></i> Create Your First Criteria
                </a>
            </div>
        {% endif %}

        <!-- Help Section -->
        <div class="row mt-5">
            <div class="col">
                <div class="card bg-light">
                    <div class="card-body">
                        <h5><i class="fas fa-info-circle"></i> About Watch Criteria</h5>
                        <p class="mb-0">
                            Watch criteria allow you to automatically monitor CarGurus for new Porsche listings that match your specific requirements. 
                            When new matches are found, you'll receive notifications via email or SMS (if configured).
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="porsche-red">Porsche Tracker</h5>
                    <p>Track, monitor, and analyze Porsche listings.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">Built with <i class="fas fa-heart porsche-red"></i> for Porsche enthusiasts</p>
                    <small class="text-muted">Python 3.13 Compatible â€¢ SQLite Database</small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function toggleCriteria(criteriaId) {
            fetch(`/api/criteria/${criteriaId}/toggle`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    // Fallback - just show a message for now
                    alert('Criteria toggle functionality will be implemented soon!');
                });
        }
    </script>
</body>
</html>
